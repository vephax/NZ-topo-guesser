<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>NZ Topo Guesser</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
</head>

  <script>
    // üìö Study Mode: Load list of HTML files from /study folder
  document.getElementById("studyBtn").onclick = () => {
    document.getElementById("studyModal").style.display = "flex";
    loadStudyFiles();
  };

  document.getElementById("closeStudyModal").addEventListener("click", () => {
    document.getElementById("studyModal").style.display = "none";
    });

  async function loadStudyFiles() {
    const studyList = document.getElementById("studyList");
    studyList.innerHTML = ""; // Clear loading message

    try {
      // We'll try to fetch a generated directory listing (only works if server allows it)
      // But since you're using file://, we can't do that. So we use a fallback list or assume known structure.

    // === OFFLINE-FRIENDLY: Manual list of known study files (you can update this) ===
    const knownFiles = [
      { name: "Organic Reaction Quiz", path: "study/organics-scheme/index.html" }
    ];

      if (knownFiles.length === 0) {
        studyList.innerHTML = "<li>No study tools found. Add some in /study/</li>";
        return;
      }

      knownFiles.forEach(file => {
        const li = document.createElement("li");
        li.style.margin = "8px 0";
        const a = document.createElement("a");
        a.href = file.path;
        a.textContent = file.name;
        a.style.padding = "10px";
        a.style.display = "block";
        a.style.backgroundColor = "#f0f8ff";
        a.style.borderRadius = "6px";
        a.style.color = "#007cba";
        a.style.textDecoration = "none";
        a.target = "_blank"; // Open in new tab
        li.appendChild(a);
        studyList.appendChild(li);
      });

      // Optional: Try to warn if /study/ folder doesn't exist
      const test = new XMLHttpRequest();
      test.open('HEAD', 'study/', false);
      test.send();
      if (test.status !== 200) {
        studyList.innerHTML = "<li style='color: #721c24;'>‚ö†Ô∏è Study folder not found. Make sure /study/ exists with HTML files.</li>";
      }

    } catch (e) {
      studyList.innerHTML = "<li style='color: #721c24;'>Could not load study files. Check folder structure.</li>";
      console.warn("Directory listing failed (expected in file://):", e);
    }
  }
</script>

<body>
  <!-- Get other files -->
  <script src="game.js" defer></script>
  <link rel="stylesheet" href="style.css" />

  <!-- Analysis Panel -->
  <div id="analysisPanel">
    <h3>Round Analysis</h3>
    <div id="analysisContent"></div>
    <button id="closeAnalysisBtn" style="margin-top:10px;">Close</button>
  </div>

  <h1 id="gameTitle">NZ Topo Guesser V - Sponsored by Water</h1>
  <!--<p id="maintenanceMessage"></p>-->

  <!-- Player Data Panel -->
  <div id="playerPanel">
    <p id="userInfo"></p>
      <button id="changePlayerBtn">Change Player</button>
  </div>

  <div id="topPanels">
    <!-- Game Selection Panel -->
    <div id="gamesPanel">
      <div id="gamesPanelHeader">
        <h3>Games</h3>
        <p>Games shown in purple text have custom settings and will not count to the overall leaderboard.</p>
        <div>
          <button class="gameCategoryButton" id="recommendedGamesTabBtn">Recommended</button>
          <button class="gameCategoryButton" id="recentGamesTabBtn">Recent</button>
          <button class="gameCategoryButton" id="playedGamesTabBtn">Played</button>
        </div>
      </div>
      <div id="gamesPanelList">Loading...</div>
    </div>

    <!-- Overall Leaderboard -->
    <div id="overallLeaderboard">
      <div>
      <h3>Overall Leaderboard</h3>
        <label>Game Type:
          <select id="overallLeaderboardGameType">
            <option value="Everywhere">Everywhere</option>
            <option value="Beach">Beach</option>
            <option value="Urban">Urban</option>
            <option value="State Highway">State Highway</option>
            <option value="Bush">Bush</option>
          </select>
        </label>
        <label>Sort Placing By:
        <select id="overallLeaderboardSortBy">
        <option value="totalScore">Total Score</option>
        <option value="gamesPlayed">Games Played</option>
        <option value="averageScore">Average Score</option>
      </select>
      </label>
    </div>
    <div id="overallLeaderboardData">
      <p>Loading...</p>
    </div>
  </div>
  </div>

  <!-- Game informtion panel -->
  <div id="gameInfoPanel">
    <button class="blueButton" id="createNewGameBtn">Create a New Game</button>
  </div>

  <!-- Game controls tab -->
  <div id="controls">
    <div id="roundInfo">Please select or create a new game</div>
    <div id="totalScore"></div>
    <div id="result"></div>
    <button id="nextRoundBtn" class="blueButton" disabled>Next Round</button>
    <button id="submitBtn" class="blueButton" disabled>Submit Guess</button>
  </div>

  <div id="container">
    <div id="mapFrameWrapper">
      <iframe id="mapFrame" src="about:blank" sandbox="allow-scripts allow-same-origin"></iframe>
    </div>
    <div id="leafletMap"></div>
  </div>

  <!-- Audio -->
  <audio id="good1" src="SoundEffects/Good/are_you_single.mp3" preload="none"></audio>
  <audio id="good2" src="SoundEffects/Good/damn_that_good.mp3" preload="none"></audio>
  <audio id="good3" src="SoundEffects/Good/canterbury_above_average.mp3" preload="none"></audio>
  <audio id="good4" src="SoundEffects/Good/family_proud.mp3" preload="none"></audio>
  <audio id="good5" src="SoundEffects/Good/fantastic.mp3" preload="none"></audio>
  <audio id="good6" src="SoundEffects/Good/gold_star.mp3" preload="none"></audio>
  <audio id="good7" src="SoundEffects/Good/hope_left_world.mp3" preload="none"></audio>
  <audio id="good8" src="SoundEffects/Good/kid_thought_chathams.mp3" preload="none"></audio>
  <audio id="good9" src="SoundEffects/Good/make_me_proud.mp3" preload="none"></audio>
  <audio id="good10" src="SoundEffects/Good/oh_yeah.mp3" preload="none"></audio>
  <audio id="good11" src="SoundEffects/Good/perfect_keep_it_up.mp3" preload="none"></audio>
  <audio id="good12" src="SoundEffects/Good/absolutely_stunning.mp3" preload="none"></audio>
  <audio id="good13" src="SoundEffects/Good/damn_smashed.mp3" preload="none"></audio>

  <audio id="bad1" src="SoundEffects/Bad/pathetic.mp3" preload="none"></audio>
  <audio id="bad2" src="SoundEffects/Bad/oh_my_chathams.mp3" preload="none"></audio>
  <audio id="bad3" src="SoundEffects/Bad/trash_perfect.mp3" preload="none"></audio>
  <audio id="bad4" src="SoundEffects/Bad/absolutely_worthless.mp3" preload="none"></audio>
  <audio id="bad5" src="SoundEffects/Bad/toddler_done_better.mp3" preload="none"></audio>
  <audio id="bad6" src="SoundEffects/Bad/try_the_naki.mp3" preload="none"></audio>
  <audio id="bad7" src="SoundEffects/Bad/mess_up_left_with_right.mp3" preload="none"></audio>
  <audio id="bad8" src="SoundEffects/Bad/disgusting_wellington_better.mp3" preload="none"></audio>
  <audio id="bad9" src="SoundEffects/Bad/111_ambulance_stupid.mp3" preload="none"></audio>
  <audio id="bad10" src="SoundEffects/Bad/missclick.mp3" preload="none"></audio>
  <audio id="bad11" src="SoundEffects/Bad/better_eyes_closed.mp3" preload="none"></audio>
  <audio id="bad12" src="SoundEffects/Bad/aghh_heart_attack.mp3" preload="none"></audio>
  <audio id="bad13" src="SoundEffects/Bad/roast_nelson.mp3" preload="none"></audio>
  
  <audio id="ranOutOfTime" src="SoundEffects/no_guess_submited.mp3" preload="none"></audio>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<div style="text-align: center; margin: 20px 0; padding: 50px; border-top: 3px solid #ccc;">
  <button id="studyBtn" style="font-size: 1em; padding: 10px 20px; background: #007cba; color: white; border: none; border-radius: 6px; cursor: pointer;">
    üìö Study like a Good Boy
  </button>
</div>

<!-- Study Modal -->
<div id="studyModal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); justify-content: center; align-items: center;">
  <div style="background: white; width: 90%; max-width: 600px; border-radius: 12px; padding: 20px; max-height: 80vh; overflow-y: auto;">
    <h2>üìö Study Tools</h2>
    <p>Select a study activity:</p>
    <ul id="studyList" style="list-style: none; padding: 0;">
      <li>Loading study files...</li>
    </ul>
    <button id="closeStudyModal" style="padding: 8px 16px; background: #555; color: white; border: none; border-radius: 6px; cursor: pointer; margin-top: 10px;">Close</button>
  </div>
</div>

<!-- ‚úÖ Fixed JavaScript: Runs after DOM loads -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  const studyBtn = document.getElementById("studyBtn");
  const studyModal = document.getElementById("studyModal");
  const closeBtn = document.getElementById("closeStudyModal");
  const studyList = document.getElementById("studyList");

  // ‚úÖ Open modal
  studyBtn.addEventListener("click", () => {
    studyModal.style.display = "flex";
    loadStudyFiles();
  });

  // ‚úÖ Close modal
  closeBtn.addEventListener("click", () => {
    studyModal.style.display = "none";
  });

  // ‚úÖ Click outside modal to close
  studyModal.addEventListener("click", (e) => {
    if (e.target === studyModal) {
      studyModal.style.display = "none";
    }
  });

  // ‚úÖ Load study files (manually defined list)
  function loadStudyFiles() {
    studyList.innerHTML = ""; // Clear loading message

    const knownFiles = [
      { name: "Organic Reaction Quiz", path: "/study/organics-scheme/index.html" }
    ];

    if (knownFiles.length === 0) {
      studyList.innerHTML = "<li>No study tools found.</li>";
      return;
    }

    knownFiles.forEach(file => {
      const li = document.createElement("li");
      const a = document.createElement("a");
      a.href = file.path;
      a.textContent = file.name;
      a.style.padding = "12px";
      a.style.display = "block";
      a.style.margin = "6px 0";
      a.style.backgroundColor = "#f0f8ff";
      a.style.borderRadius = "6px";
      a.style.color = "#007cba";
      a.style.fontWeight = "500";
      a.style.textDecoration = "none";
      a.target = "_blank"; // Opens in new tab
      li.appendChild(a);
      studyList.appendChild(li);
    });
  }
});
</script>
  
</body>
</html>
